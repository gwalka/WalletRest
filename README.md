# Wallet Rest
___
## Стек
Java 17, Spring Boot, Gradle, PostgreSQL, Apache Kafka, Docker, Swagger
___
## Инструкция по запуску

```bash
git clone https://github.com/gwalka/WalletRest.git
```
```bash
cd WalletRest
```
```bash
./gradlew clean build -x test
```
```bash
docker compose up --build
```

## После успешного старта:

Запускаются Kafka, база данных PostgreSQL и само приложение.

Протестировать API можно по адресу:
```bash
http://localhost:8080/swagger-ui/index.html
```
В миграции предусмотрен кошелек для тестирования:
550e8400-e29b-41d4-a716-446655440000
Баланс: 1000

___

## Описание архитектуры и производительности
Приложение разработано с учётом требований работы в высококонкурентной среде с нагрузкой в 1000 TPS на один кошелёк.

| Метрика                          | Значение            |
| -------------------------------- | ------------------- |
| Общее количество запросов        | 140,849             |
| Успешные запросы                 | 99.89% (140,700)    |
| Ошибки                           | 0.10% (149)         |
| Среднее время отклика HTTP       | 5.91 ms             |
| Максимальное время отклика       | 479.77 ms           |
| Скорость запросов                | \~2343 req/сек      |
| Время выполнения итерации        | 106.57 ms (среднее) |

Время записи в базу данных  с  13:26:49 до 13:28:46
___
# Системный дизайн и ключевые особенности
## Event-driven архитектура с Kafka:
Все операции (пополнение и снятие средств) обрабатываются через события, публикуемые в логические топики.

## Валидация входящих запросов:
Проверка на соответствие бизнес-требованиям до публикации событий.

## Последовательная обработка событий для одного кошелька:
События маршрутизируются по UUID кошелька, что обеспечивает попадание всех запросов пользователя в одну партицию Kafka и последовательную обработку.

## Оптимистичная блокировка (@Version) на уровне сущности:
Для предотвращения конфликтов при параллельном обновлении без пессимистичных блокировок.

## Транзакционная запись с retry:
Логика повторных попыток записи в базу при временных сбоях с учётом бизнес-правил.

## Обработка ошибок:
Сообщение считается обработанным только после успешного коммита или при изменении состояния объекта (ошибка бизнес-валидации).


